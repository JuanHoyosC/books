<ion-content [fullscreen]="true" class="no-scroll">
  <div class="container">
    <header>
      <!--<ion-img src="/assets/icon/auth/welcome.jpg"></ion-img>-->
      <ion-text color="primary" class="ion-text-center w-100">
        <h2 class="ion-no-margin ion-margin-bottom">Reset your password</h2>
      </ion-text>
    </header>
    <form class="auth ion-padding" [formGroup]="form" (submit)="submit()">
      <ion-list lines="none">
        @if(step === "SEND_CODE") {
        <ion-item>
          <ion-label position="stacked" class="required">Username</ion-label>
          <ion-input
            type="text"
            placeholder="Enter your username"
            formControlName="username"
          ></ion-input>
          @if(form.controls['username'].invalid &&
          form.controls['username'].touched) {
          <ion-text color="danger" class="error">
            <small>El campo no cumple el patron</small>
          </ion-text>
          }
        </ion-item>
        }@else {
        <ion-item>
          <app-verify-input
            [positions]="positions"
            formControlName="code"
            class="w-100"
          ></app-verify-input>
          @if(form.controls['code'].invalid && form.controls['code'].touched) {
          <ion-text color="danger" class="error">
            <small>El campo no cumple el patron</small>
          </ion-text>
          }
        </ion-item>
        <ion-item>
          <ion-label position="stacked" class="required">Password</ion-label>
          <ion-input
            type="password"
            placeholder="Enter your password"
            formControlName="password"
          >
            <ion-input-password-toggle slot="end"></ion-input-password-toggle>
          </ion-input>
          @if(form.controls['password'].invalid &&
          form.controls['password'].touched) {
          <ion-text color="danger" class="error">
            <small>El campo no cumple el patron</small>
          </ion-text>
          }
        </ion-item>
        <ion-item>
          <ion-label position="stacked" class="required"
            >Repeat password</ion-label
          >
          <ion-input
            type="password"
            placeholder="Enter your password"
            formControlName="repeatPassword"
            autocomplete="new-password"
          >
            <ion-input-password-toggle slot="end"></ion-input-password-toggle>
          </ion-input>
          @if(form.controls['repeatPassword'].invalid &&
          form.controls['repeatPassword'].touched && !form.errors?.['mismatch'])
          {
          <ion-text color="danger" class="error">
            <small>El campo no cumple el patron</small>
          </ion-text>
          } @if(form.errors?.['mismatch'] && (form.controls['password'].touched
          && form.controls['repeatPassword'].touched)) {
          <ion-text color="danger" class="error">
            <small>Las contrase√±as no coinciden</small>
          </ion-text>
          }
        </ion-item>

        <ion-item>
          <ion-button
            type="button"
            expand="block"
            fill="clear"
            (click)="resendCode()"
            [disabled]="timer !== 0"
          >
            @if(timer === 0) {
            <ion-label>Resend code</ion-label>
            } @else {
            <span>Resend code in {{ timer }} seconds</span>
            }
          </ion-button>
        </ion-item>
        }
        <ion-item>
          <app-ion-button-loading
            class="w-100"
            type="submit"
            text="Login"
            [disabled]="
              loading ||
              (step === 'SEND_CODE' &&
                this.form.controls['username'].invalid) ||
              (step === 'RESET_PASSWORD' && this.form.invalid)
            "
            [loading]="loading"
          ></app-ion-button-loading>
        </ion-item>
      </ion-list>
    </form>
    <div class="bubble bottom left"></div>
    <div class="bubble small top right"></div>
  </div>
</ion-content>
